// minigameDisplayHgt = Height of minigame in hud lines
// svar_set minigameDisplayIdx 0
// sar_expand repeat "sar_expand sar_expand sar_hud_set_text $$minigameDisplayIdx $$$$minigameDisplayBuf$$minigameDisplayIdx; svar_add minigameDisplayIdx 1" $minigameDisplayHgt

// Textures
svar_set sartris_tex_empty  "#7F7F7F.."
svar_set sartris_tex_piece0 "#00FFFF[]" // I piece
svar_set sartris_tex_piece1 "#0000FF[]" // J piece
svar_set sartris_tex_piece2 "#FF7F00[]" // L piece
svar_set sartris_tex_piece3 "#FFFF00[]" // O piece
svar_set sartris_tex_piece4 "#800080[]" // T piece
svar_set sartris_tex_piece5 "#00FF00[]" // S piece
svar_set sartris_tex_piece6 "#FF0000[]" // Z piece

sar_expand svar_set sartris_tex_empty_x4 "$sartris_tex_empty$sartris_tex_empty$sartris_tex_empty$sartris_tex_empty"

// Display buffer for the game grid
sar_function   sartris_dbuf_set     "svar_set sartris_dbuf_$2_$1 $'$3$'"
sar_alias      sartris_dbuf_clear   "svar_set __tmp -2; repeat __sartris_dbuf_clear_r 22"
sar_alias    __sartris_dbuf_clear_r "svar_set __tmp1 0; repeat __sartris_dbuf_clear_c 10; svar_add __tmp 1"
sar_function __sartris_dbuf_clear_c "sartris_dbuf_set $__tmp1 $__tmp $sartris_tex_empty; svar_add __tmp1 1"
sartris_dbuf_clear

// Display buffer for the Next piece display
// Got lazy here
sar_function   sartris_nbuf_set     "svar_set sartris_nbuf_$2_$1 $'$3$'"
sar_alias      sartris_nbuf_clear   "svar_set __tmp 1; repeat __sartris_nbuf_clear_r 4"
sar_alias    __sartris_nbuf_clear_r "svar_set __tmp1 0; repeat __sartris_nbuf_clear_c 4; svar_add __tmp 1"
sar_function __sartris_nbuf_clear_c "sartris_nbuf_set $__tmp1 $__tmp $'  $'; svar_add __tmp1 1"

sar_function   sartris_nbuf_compose "svar_set __tmp 0; repeat __sartris_nbuf_compose_r 5"
sar_function __sartris_nbuf_compose_r "sar_expand svar_set sartris_nbuf_$__tmp $'$$sartris_nbuf_$__tmp$-_0$$sartris_nbuf_$__tmp$-_1$$sartris_nbuf_$__tmp$-_2$$sartris_nbuf_$__tmp$-_3$'; svar_add __tmp 1"

sartris_nbuf_clear

sar_alias sartris_player_undraw sartris_player_minocoord_foreach __sartris_player_undraw
sar_function __sartris_player_undraw sartris_dbuf_set $1 $2 $sartris_tex_empty

sar_alias sartris_player_draw sartris_player_minocoord_foreach __sartris_player_draw
sar_function __sartris_player_draw sar_expand sartris_dbuf_set $1 $2 $$sartris_tex_piece$sartris_player_piece

sar_function sartris_next_draw "sartris_nbuf_clear; sartris_next_minocoord_foreach __sartris_next_draw; sartris_nbuf_set 0 0 $'#7F7F7F NEXT: $'; sartris_nbuf_compose"
sar_function __sartris_next_draw "svar_add __tmp_x 1; svar_add __tmp_y 1; svar_add __tmp_y __mino_$sartris_next_piece$-top; sar_expand sartris_nbuf_set $$__tmp_x $$__tmp_y $$sartris_tex_piece$sartris_next_piece"

// sar_function sartris_nbuf_reset "svar_set __sartris_dbuf_0 $'  NEXT: $'; svar_set __sartris_dbuf_1 $'$sartris_tex_empty_x4$'; svar_set __sartris_dbuf_2 $'$sartris_tex_empty_x4$'; svar_set __sartris_dbuf_3 $'$sartris_tex_empty_x4$'; svar_set __sartris_dbuf_4 $'$sartris_tex_empty_x4$'"
sar_function sartris_draw "svar_set __stris_dii 0; svar_set __stris_dih $sartris_hud_offset; repeat $'sartris_draw_row; svar_add __stris_dii 1; svar_add __stris_dih 1$' 20"
sar_function sartris_draw_row "sar_expand sar_hud_set_text $__stris_dih $'$$sartris_dbuf_$__stris_dii$-_0$$sartris_dbuf_$__stris_dii$-_1$$sartris_dbuf_$__stris_dii$-_2$$sartris_dbuf_$__stris_dii$-_3$$sartris_dbuf_$__stris_dii$-_4$$sartris_dbuf_$__stris_dii$-_5$$sartris_dbuf_$__stris_dii$-_6$$sartris_dbuf_$__stris_dii$-_7$$sartris_dbuf_$__stris_dii$-_8$$sartris_dbuf_$__stris_dii$-_9  $$sartris_nbuf_$__stris_dii$'"
